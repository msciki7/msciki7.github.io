---
title: "chapter4. Generalized Forwarding, SDN"
excerpt: ""

wirter: sohee Kim
categories:
  - Computer Network
tags:
  - CS

toc: true
use_math: true 
toc_sticky: true

date: 2025-11-25
last_modified_at: 2025-11-25
---

Generalized Forwarding(일반화된 포워딩)
=====

&ensp;**"match + action" 모델**<br/>
&ensp;네트워크 라우터가 패킷을 처리할 때 사용하는 가장 핵심 논리는 아래 한 문장으로 요약된다.<br/>
&ensp;패킷 헤더의 특정 비트들을 보고(match), 그에 따라 특정 행동(action)을 한다.<br/>

* 어떤 패킷이 오면
* 그 패킷의 헤더(출발지/목적지 IP, 포트, 프로토콜 등)를 확인하고
* 거기에 맞는 규칙(rule)을 찾아
* 지정된 행동(전달/드롭/수정/로그 등)을 실행한다.

&ensp;기존 라우터 vs SDN 라우터 차이<br/>
&ensp;기존 라우터: Destination-based Forwarding<br/>
* 패킷의 목적지 IP 주소만 보고
* 어느 포트로 보내야 하는지 결정

&ensp;SDN 라우터: Generalized Forwarding<br/>
<p align="center"><img src="/assets/img/Computer Network/chapter 4. Network Layer/4-49.png" width="500"></p>

* 목적지 IP뿐 아니라 출발지 IP, 포트번호, 프로토콜, TCP flag, VLAN tag 등 다양한 헤더 요소를 보고
* 다양한 action 수행 가능

&ensp;예:<br/>
* 특정 패킷은 드롭
* 보안 패킷은 로그 생성
* QoS 패킷은 우선순위 높게 전달
* 특정 트래픽은 컨트롤러에게 전달

## Flow Table(플로우 테이블) = 라우터의 뇌

&ensp;Flow = "헤더 필드 값들의 조합으로 정의되는 트래픽 그룹"<br/>

&ensp;예:<br/>
* src=10.1.2.3, dest=8.8.8.8
* port=80인 모든 패킷
* TCP SYN 플래그만 켜진 패킷

&ensp;Flow Table 구성요소<br/>
&ensp;Flow table 안에는 여러 개의 rule(규칙)이 있고, 각 규칙은 아래 4가지 정보로 구성됨:<br/>
<p align="center"><img src="/assets/img/Computer Network/chapter 4. Network Layer/4-50.png" width="500"></p>

1. match
* 패킷 헤더에서 “어떤 패턴이 오면” 이 규칙을 적용할지 정의
* 예: `src=1.2.*.*, dest=3.4.*.*`
2. action
* 매칭 되면 어떤 행동을 할지
* 예:
    - forward(2번 포트로 보냄)
    - drop
    - modify(헤더 값 바꿈)
    - send to controller
3. priority
* 여러 규칙이 동시에 match될 때 어떤 규칙을 우선 적용할지
* (시험 단골) 가장 구체적인 패턴일수록 보통 우선순위가 높음
4. counters
* 해당 규칙이 몇 번 사용되었는지 (#packets, #bytes)

&ensp;예시<br/>
<p align="center"><img src="/assets/img/Computer Network/chapter 4. Network Layer/4-51.png" width="500"></p>

| 매칭 조건(match)                  | 행동(action)         |
| ----------------------------- | ------------------ |
| src = *. *.*.*, dest=3.4.*.*  | forward(2번 포트로)    |
| src = 1.2.*.*, dest=*. *.*.*  | drop               |
| src = 10.1.2.3, dest=*. *.*.* | send to controller |

&ensp;이해 포인트<br/>
* `*`(wildcard)는 아무 값이나 허용한다는 뜻
* 즉, 특정 필드만 신경 쓰고 나머지는 무시하는 규칙 작성 가능
* 더 구체적인 규칙이 있다면 priority를 이용해 우선 적용된다

&ensp;왜 이런 구조가 필요할까?<br/>
&ensp;SDN의 핵심은 유연성과 중앙제어<br/>
&ensp;전통 라우터는 목적지 주소 하나만 보고 행동했지만 SDN에서는 (controller가 관리) 복잡하고 다양한 트래픽을 세밀하게 제어할 수 있어야 했다.<br/>
* 패킷 "종류별로" 다른 행동 지정 가능
* 방화벽, NAT, QoS와 같은 기능을 하나의 모델로 통합
* 네트워크 정책을 중앙에서 쉽게 변경 가능

### OpenFlow: Flow Table Entries

&ensp;1. Flow Table는 3부분으로 구성됨<br/>
```sql
┌───────────┬──────────┬────────────┐
│   Match   │  Action  │   Stats    │
└───────────┴──────────┴────────────┘
```

<p align="center"><img src="/assets/img/Computer Network/chapter 4. Network Layer/4-52.png" width="500"></p>

&ensp;Match<br/>
* 패킷의 어떤 부분을 검사할지 정의
* 즉 "이런 헤더를 가진 패킷이 들어오면…"

&ensp;Action<br/>
* 해당 패킷을 발견했을 때 어떤 행동을 할지
* 시험에서 꼭 외우는 4가지:
1. 특정 포트로 전송 (forward)
2. 패킷 드롭
3. 헤더 수정
4. controller로 보내기 (send to controller)

&ensp;Stats (Counters)<br/>
* 이 규칙이 몇 번 사용되었는지 기록 (#packets, #bytes)

&ensp;2. Match할 수 있는 Header Fields<br/>
&ensp;Link Layer(2계층)<br/>
* Ingress Port
* Src MAC
* Dst MAC
* Eth type
* VLAN ID
* VLAN Priority

&ensp;Network Layer(3계층)<br/>
* IP Src
* IP Dst
* IP Protocol
* IP ToS(DSCP)

&ensp;Transport Layer(4계층)<br/>
* TCP/UDP Source Port
* TCP/UDP Destination Port

&ensp;OpenFlow는 L2 ~ L4 헤더 전체를 match할 수 있다 → 일반 라우터/스위치보다 훨씬 강력함.<br/>

&ensp;Examples<br/>
&ensp;Example 1 — 목적지 기반 포워딩<br/>
<p align="center"><img src="/assets/img/Computer Network/chapter 4. Network Layer/4-53.png" width="500"></p>

&ensp;규칙: IP Dst = 51.6.0.8 → output port = 6<br/>
&ensp;목적지 IP가 특정 값이면 port6으로 보냄 → 기존 라우팅 테이블과 거의 같은 동작<br/>

&ensp;Example 2 — Firewall<br/>
<p align="center"><img src="/assets/img/Computer Network/chapter 4. Network Layer/4-54.png" width="500"></p>

&ensp;Firewall rule 1<br/>
* TCP destination port = 22(SSH) → drop<br/>
&ensp;SSH 접속 패킷은 전부 차단<br/>

&ensp;Firewall rule 2<br/>
* Src IP = 128.119.1.1 → drop<br/>
&ensp;특정 출발지 IP에서 오는 모든 트래픽 차단<br/>

&ensp;Example 3 — L2 Switch 동작<br/>
<p align="center"><img src="/assets/img/Computer Network/chapter 4. Network Layer/4-55.png" width="500"></p>

&ensp;규칙: MAC dest = 22:A7:23:11:E1:02 → forward to port3<br/>
&ensp;이건 스위치의 MAC learning table과 똑같은 기능. 하지만 차이점은 기존 스위치는 L2 header만 보지만 OpenFlow는 L2~L4까지 전부 보고 match할 수 있음.<br/>

### OpenFlow Abstraction

&ensp;OpenFlow의 match+action 모델은 여러 네트워크 장비들의 공통된 동작을 하나로 통합하는 추상화이다.<br/>

&ensp;Router<br/>
* match: longest prefix match
* action: forward

&ensp;Switch<br/>
* match: destination MAC
* action: forward/flood

&ensp;Firewall<br/>
* match: IP + TCP/UDP port
* action: permit/deny

&ensp;NAT<br/>
* match: IP address & port
* action: rewrite address/port

&ensp;OpenFlow Example<br/>
<p align="center"><img src="/assets/img/Computer Network/chapter 4. Network Layer/4-56.png" width="500"></p>

&ensp;SDN 컨트롤러가 전체 네트워크를 통합적으로 제어 가능함을 보여주는 예시이다.<br/>

&ensp;목표<br/>
* host h5, h6 → h3/h4로 트래픽을 보내야 함
* 경로는: h5/h6 → s3 → s1 → s2 → h3/h4

&ensp;각 스위치(s1, s2, s3)의 flow table을 컨트롤러가 미리 적절하게 설정해놓으면 전체 네트워크 레벨에서 행동이 결정됨<br/>
* Control plane 중앙 집중화
* Data plane은 단순히 match+action만 수행
* 전체 경로를 프로그래밍하듯 제어 가능

<p align="center"><img src="/assets/img/Computer Network/chapter 4. Network Layer/4-57.png" width="500"></p>

&ensp;1. 스위치 s3의 Flow Table<br/>
&ensp;Match<br/>
* IP Src = 10.3.*.* (h5/h6)
* IP Dst = 10.2.*.* (h3/h4)

&ensp;Action<br/>
* forward(3)

&ensp;h5/h6 → h3/h4 방향 트래픽은 s3의 3번 포트로 보내라는 뜻이다. 그럼 s3 → (port3 연결된 곳) → s1로 전달된다.<br/>

&ensp;2. 스위치 s1의 Flow Table<br/>
&ensp;Match<br/>
* ingress port = 1 (즉, s3에서 온 패킷)
* IP Src = 10.3.*.*
* IP Dst = 10.2.*.*

&ensp;Action<br/>
* forward(4)

&ensp;s3에서 오는 트래픽을 s1의 4번 포트로 보내라 → s1 port4는 s2로 연결된다. s1은 이 트래픽을 s2에게 넘긴다.<br/>

&ensp;3. 스위치 s2의 Flow Table<br/>
&ensp;s2는 목적지에 따라 두 갈래로 forwarding 한다.<br/>
1. 목적지 = h3 (IP 10.2.0.3)
* ingress port = 2 (s1에서 옴)
* IP Dst = 10.2.0.3 → forward(3)
2. 목적지 = h4 (IP 10.2.0.4)
* ingress port = 2
* IP Dst = 10.2.0.4 → forward(4)

* h5/h6 → h3이면 port3
* h5/h6 → h4이면 port4 로 보내면 도착

Summary
=====

&ensp;**match + action 모델**<br/>
* 패킷 헤더의 비트를 보고(match)
* 정해진 행동을 한다(action)

&ensp;헤더 필드는 L2~L4 아무거나 가능:<br/>
* MAC 주소
* VLAN
* IP 주소
* 프로토콜
* TCP/UDP 포트 <br/>
&ensp;→ 모든 장비(스위치, 방화벽, 라우터, NAT)를 하나의 공통 모델로 설명 가능.<br/>

&ensp;**가능한 Action들**<br/>
* drop
* forward
* modify (헤더 수정)
* controller에게 보내기<br/>
&ensp;이 네 가지 조합으로 어떤 네트워크 장비든 만들 수 있음.<br/>

&ensp;**network-wide behaviors를 프로그래밍**<br/>
&ensp;SDN 컨트롤러는 네트워크 전체의 동작을 "프로그램"한다. 스위치는 데이터 플레인에서 match+action만 수행한다.<br/>

&ensp;**Network Programmability**<br/>
&ensp;OpenFlow는 프로그래머블 네트워크의 시작이며 오늘날에는 더 강력한 언어(P4; packet processing을 코딩하는 언어)로 확장됨.<br/>